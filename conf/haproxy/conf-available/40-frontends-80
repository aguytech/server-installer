# included file for haproxy configuration

frontend http
	bind :80
	mode http
	option			forwardfor except 127.0.0.0/8
	option			httplog
	http-request 	set-header X-Forwarded-Protocol http
	default_backend	default

	acl letsencrypt			path_beg /.well-known/acme-challenge/
	acl _DOMAIN_FQDN		hdr_end(host) -i _DOMAIN_FQDN
	#acl _DOMAIN_FQDN			hdr_sub(host) -i _DOMAIN_FQDN
	acl _DOMAIN_FQDN-check		path_dir /ping-monitor /server-status /server-info /status-www /status-www-admin /ping-www
	#acl _DOMAIN_FQDN-check		path_reg ^/(ping-monitor|server-status|server-info|status-www|status-www-admin|ping-www)
	#acl _DOMAIN_FQDN-check		path_beg /server-status /server-info /status-www /status-www-admin /ping-www /ping-monitor
	acl _DOMAIN_FQDN-admin		hdr(host) admin._DOMAIN_FQDN matomo._DOMAIN_FQDN monitor._DOMAIN_FQDN pfa._DOMAIN_FQDN pma._DOMAIN_FQDN
	#acl _DOMAIN_FQDN-cloud		hdr(host) cloud._DOMAIN_FQDN nextcloud._DOMAIN_FQDN

	# _DOMAIN_2_FQDN
	#acl _DOMAIN_2_FQDN			hdr_end(host) -i _DOMAIN_2_FQDN

	#redirect		scheme https code 301 if _DOMAIN_FQDN !_DOMAIN_FQDN-check !letsencrypt !{ ssl_fc }
	#redirect		scheme https code 301 if !_DOMAIN_FQDN-check !letsencrypt !{ ssl_fc }

	use_backend		letsencrypt if letsencrypt
	use_backend		_DOMAIN_FQDN-admin if _DOMAIN_FQDN-admin
	#use_backend		_DOMAIN_FQDN-cloud if _DOMAIN_FQDN-cloud
	#use_backend		_DOMAIN_FQDN-admin if _DOMAIN_FQDN-admin or _DOMAIN_2_FQDN-admin
	use_backend		_DOMAIN_FQDN if _DOMAIN_FQDN || _DOMAIN_FQDN-check
	#use_backend		_DOMAIN_2_FQDN if _DOMAIN_2_FQDN
