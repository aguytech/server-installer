# AMBAU
# included file for haproxy configuration

frontend	https
	bind	*:443 ssl crt-list /etc/server/ssl/private/letsencrypt.pem.lst

	default_backend		default

	http-request				set-header X-Forwarded-Protocol https
	#http-request				set-header X-Forwarded-Port %[dst_port]

	acl _DOMAIN_NAME					hdr_end(host) -i _DOMAIN_FQDN
	#acl wigwam					hdr(host) -i cloud.wigwam.bzh cloud.coworking-lannion.org
	acl _DOMAIN_2_NAME				hdr_end(host) -i _DOMAIN_2_FQDN

	acl _DOMAIN_NAME-admin		hdr(host) admin._DOMAIN_FQDN matomo._DOMAIN_FQDN monitor._DOMAIN_FQDN pfa._DOMAIN_FQDN pma._DOMAIN_FQDN

	#acl _DOMAIN_2_NAME-admin	hdr(host) admin._DOMAIN_2_FQDN matomo._DOMAIN_2_FQDN monitor._DOMAIN_2_FQDN pfa._DOMAIN_2_FQDN pma._DOMAIN_2_FQDN
	#acl letsencrypt	path_beg /.well-known/acme-challenge/
	#acl admin-dev		src 92.154.29.60 129.20.228.3 129.20.228.19 129.20.228.20 129.20.228.21

	#redirect	prefix	https://info.otokoz.ovh code 301 if { hdr(host) -i info._DOMAIN_FQDN }

	use_backend				_DOMAIN_NAME-admin if _DOMAIN_NAME-admin
	#use_backend			_DOMAIN_NAME-admin if _DOMAIN_NAME-admin or _DOMAIN_2_NAME-admin
	use_backend				_DOMAIN_NAME if _DOMAIN_NAME
	#use_backend			_DOMAIN_NAME if { hdr_end(host) -i _DOMAIN_FQDN }
	#use_backend			_DOMAIN_NAME-test if _DOMAIN_NAME-test
	use_backend				_DOMAIN_2_NAME if _DOMAIN_2_NAME
	#use_backend				wigwam if wigwam
	#use_backend			letsencrypt if letsencrypt
