# included file for haproxy configuration

frontend https
	bind :443			ssl crt-list S_PATH_CONF_SSL/private/letsencrypt.pem.lst
	#bind :443			ssl crt ambau.ovh.pem
	mode http
	option				httplog
	option				forwardfor except 127.0.0.0/8
	http-request		set-header X-Forwarded-Protocol https
	#http-request		set-header X-Forwarded-Port %[dst_port]
	default_backend		default

	acl _DOMAIN_FQDN		hdr_end(host) -i _DOMAIN_FQDN
	acl _DOMAIN_2_FQDN		hdr_end(host) -i _DOMAIN_2_FQDN
	acl _DOMAIN_FQDN-admin	hdr(host) admin._DOMAIN_FQDN matomo._DOMAIN_FQDN monitor._DOMAIN_FQDN pfa._DOMAIN_FQDN pma._DOMAIN_FQDN
	#acl _DOMAIN_FQDN-cloud	hdr(host) cloud._DOMAIN_FQDN nextcloud._DOMAIN_FQDN

	#acl _DOMAIN_2_FQDN-admin	hdr(host) admin._DOMAIN_2_FQDN matomo._DOMAIN_2_FQDN monitor._DOMAIN_2_FQDN pfa._DOMAIN_2_FQDN pma._DOMAIN_2_FQDN
	#acl admin-dev		src 92.154.29.60 129.20.228.3 129.20.228.19 129.20.228.20 129.20.228.21

	#redirect  prefix  https://info.otokoz.ovh code 301 if { hdr(host) -i info._DOMAIN_FQDN }

	use_backend		_DOMAIN_FQDN-admin if _DOMAIN_FQDN-admin
	#use_backend		_DOMAIN_FQDN-cloud if _DOMAIN_FQDN-cloud
	#use_backend		_DOMAIN_FQDN-admin if _DOMAIN_FQDN-admin or _DOMAIN_2_FQDN-admin
	use_backend		_DOMAIN_FQDN if _DOMAIN_FQDN
	#use_backend		_DOMAIN_FQDN if { hdr_end(host) -i _DOMAIN_FQDN }
	use_backend		_DOMAIN_2_FQDN if _DOMAIN_2_FQDN
