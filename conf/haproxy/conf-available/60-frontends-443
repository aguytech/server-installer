# included file for haproxy configuration

frontend https
	bind *:443			ssl crt-list S_PATH_CONF_SSL/private/letsencrypt.pem.lst
	#bind *:443		ssl crt ambau.ovh.pem

	default_backend		default

	http-request				set-header X-Forwarded-Protocol https
	#http-request				set-header X-Forwarded-Port %[dst_port]

	acl S_DOMAIN_FQDN					hdr_end(host) -i S_DOMAIN_FQDN
	#acl wigwam					hdr(host) -i cloud.wigwam.bzh cloud.coworking-lannion.org
	acl _HPX_DOMAIN_2_FQDN				hdr_end(host) -i _HPX_DOMAIN_2_FQDN
	acl S_DOMAIN_FQDN-admin		hdr(host) admin.S_DOMAIN_FQDN matomo.S_DOMAIN_FQDN monitor.S_DOMAIN_FQDN pfa.S_DOMAIN_FQDN pma.S_DOMAIN_FQDN
	acl letsencrypt		path_beg /.well-known/acme-challenge/

	#acl _HPX_DOMAIN_2_FQDN-admin	hdr(host) admin._HPX_DOMAIN_2_FQDN matomo._HPX_DOMAIN_2_FQDN monitor._HPX_DOMAIN_2_FQDN pfa._HPX_DOMAIN_2_FQDN pma._HPX_DOMAIN_2_FQDN
	#acl admin-dev		src 92.154.29.60 129.20.228.3 129.20.228.19 129.20.228.20 129.20.228.21

	#redirect	prefix	https://info.otokoz.ovh code 301 if { hdr(host) -i info.S_DOMAIN_FQDN }

	use_backend				S_DOMAIN_FQDN-admin if S_DOMAIN_FQDN-admin
	#use_backend			S_DOMAIN_FQDN-admin if S_DOMAIN_FQDN-admin or _HPX_DOMAIN_2_FQDN-admin
	use_backend				S_DOMAIN_FQDN if S_DOMAIN_FQDN
	#use_backend			S_DOMAIN_FQDN if { hdr_end(host) -i S_DOMAIN_FQDN }
	use_backend				_HPX_DOMAIN_2_FQDN if _HPX_DOMAIN_2_FQDN
	use_backend			letsencrypt if letsencrypt
