# AMBAU
# included file for haproxy configuration


backend	default
	server 		default						S_SERVICE[http]:80 maxconn 20 check

#backend		letsencrypt
#	server		letsencrypt 127.0.0.1:50000

backend S_DOMAIN_NAME
	#balance	roundrobin
	# retries x times before to redispatch to other server
	#retries	3
	#option		redispatch
	#option						httpchk GET /ping-monitor "HTTP/1.1\r\nHost: S_DOMAIN_FQDN"
	option						httpchk GET /ping-monitor
	http-check	            expect string pong
	default-server			inter 3s fall 4 rise 2

	# 16000000 seconds: a bit more than 6 months
	http-response			set-header Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;"

	server			S_DOMAIN_NAME1					S_SERVICE[http]:80 weight 10 maxconn 60 check inter 2s
	#server			S_DOMAIN_NAME2					S_DOMAIN_FQDN-2:80 weight 10 maxconn 60 check inter 2s backup
	#server			S_DOMAIN_NAME1					S_DOMAIN_FQDN-1:80 weight 10 check inter 2s
	#server			S_DOMAIN_NAME2					S_DOMAIN_FQDN-2:80 weight 10 check inter 2s backup

backend _HPX_DOMAIN_2_NAME
	option						httpchk GET /ping-monitor
	http-check				expect string pong
	default-server 		inter 3s fall 4 rise 2

	# 16000000 seconds: a bit more than 6 months
	http-response set-header Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;"

	#server			_HPX_DOMAIN_2_NAME1				_HPX_DOMAIN_2_FQDN-1:80 weight 10 maxconn 60 check inter 2s
	#server			_HPX_DOMAIN_2_NAME2				_HPX_DOMAIN_2_FQDN-2:80 weight 10 maxconn 60 check inter 2s backup

backend	admin
	#option					httpchk GET /ping-www HTTP/1.1\r\nHost:\ admin.S_DOMAIN_FQDN
	option						httpchk GET /ping-monitor
	http-check				expect string admin
	default-server			inter 3s fall 4 rise 2
	#option		allbackups

	# 16000000 seconds: a bit more than 6 months
	http-response set-header Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;"

	#server			admin		S_SERVICE[admin]:80  weight 10 maxconn 10 check inter 2s
	#server			admin2		S_SERVICE[admin]:80  weight 10 maxconn 10 check inter 2s backup
