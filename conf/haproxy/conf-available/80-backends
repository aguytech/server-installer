# AMBAU
# included file for haproxy configuration


backend	default
	server	default  S_SERVICE[http]:80 maxconn 20 check

#backend				letsencrypt
#	server					letsencrypt 127.0.0.1:50000

backend S_DOMAIN_NAME
	#option				httpchk GET /ping-monitor "HTTP/1.1\r\nHost: S_DOMAIN_FQDN"
	option					httpchk GET /ping-monitor
	http-check			expect string pong
	default-server		weight 20  maxconn 30  check  inter 4s  fall 2  rise 1
	http-response		set-header  Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;" # 16000000 seconds ~ 6 months

	## balance
	#balance				roundrobin
	#cookie				PROXYBAL insert
	#retries				3  # retries x times before to redispatch to other server
	#option				redispatch
	#server	S_DOMAIN_NAME1		www-S_DOMAIN_NAME-1:80  cookie S_DOMAIN_NAME1
	#server	S_DOMAIN_NAME2		www-S_DOMAIN_NAME-2:80  cookie S_DOMAIN_NAME2
	#server	S_DOMAIN_NAME3		www-S_DOMAIN_NAME-3:80  cookie S_DOMAIN_NAME3
	#server	S_DOMAIN_NAME4		www-S_DOMAIN_NAME-4:80  cookie S_DOMAIN_NAME4

	## backup
	server	S_DOMAIN_NAME1		S_SERVICE[http]:80
	#server	S_DOMAIN_NAME2		www-S_DOMAIN_NAME-2:80  backup

backend _HPX_DOMAIN_2_NAME
	option					httpchk GET /ping-monitor
	http-check			expect string pong
	default-server 	inter 4s fall 2 rise 1

	# 16000000 seconds: a bit more than 6 months
	http-response set-header Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;"

	#server	_HPX_DOMAIN_2_NAME1		www-_HPX_DOMAIN_2_FQDN-1:80 weight 10 maxconn 30 check inter 4s
	#server	_HPX_DOMAIN_2_NAME2		www-_HPX_DOMAIN_2_FQDN-2:80 weight 10 maxconn 30 check inter 4s backup

backend	admin
	#option				httpchk GET /ping-www HTTP/1.1\r\nHost:\ admin.S_DOMAIN_FQDN
	option					httpchk GET /ping-monitor
	http-check			expect string admin
	default-server		weight 30 maxconn 5  check inter 4s fall 2 rise 1
	#option				allbackups

	# 16000000 seconds: a bit more than 6 months
	http-response		set-header Strict-Transport-Security "max-age=16000000; includeSubDomains; preload;"

	#server	admin 		S_SERVICE[admin]:80
	#server	admin2		S_SERVICE[admin]:80 backup
